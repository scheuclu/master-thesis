\documentclass[../main.tex]{subfiles}
%\usepackage{import}
\begin{document}
\setlength{\delimitershortfall}{0pt}

\section{The Finite Volume method}
\subsection{General}
Like \ac{FD} or \ac{FE}, the \ac{FV} method is a mean to solving a \ac{PDE} by transforming it into a discrete algebraic form. In the field of fluid mechanics, the finite volume method is the most popular approach. Other than \ac{FD} or \ac{FE}, the finite volume is conservative by construction(we will explain what that means in Section \textbf{TODO}). Other than \ac{FD} it can easily be implemented for unstructured grids. Compared to the \ac{FE} method, where boundary conditions come naturally from the formulation, this causes some difficulties in \ac{FV}.\\
It shall also be mentioned that the introduction of stabilization schemes(like streamline upwinding), is much easier in an \ac{FV} formulation.
Overall, for \ac{CFD}, \ac{FV} has so far shown to be the best compromise between accuracy, stability and efficiency.
 \\
 \\
Finite volume methods are typically derived from the so called conservative form of a \ac{PDE}. It is shown in Section~\ref{sec:conservative_form_nsg}, that the \ac{NSE} equation can be  brought to the same form. In general, the conservative form can be written as:
\begin{align}
\tfrac{\vec{\xi}}{t}+\nabla\cdot f(\vec{\xi}) = \vec{0} \\
\end{align}
where $\vec{\xi}$ represents a vector of states and $f$ is the so-called flux tensor.\\
After subdividing the domain into finite volumes, also called cells, on can write for each particular cell $i$
\begin{align}
\int_{V_i} \tfrac{\vec{\xi}}{t} dV_i + \int_{V_i} \nabla\cdot f(\vec{\xi}) dV_i
\end{align}

After applying the divergence theorem to the second term this gives:
\begin{align}
\tfrac{~}{t}\int_{V_i} \vec{\xi} dV_i + \int_{\partial V_i} f(\vec{\xi})\cdot\normal~dS_i
\end{align}
And after integration the first term to get the volume average
\begin{align}
V_i \tfrac{\dvec{\bar{\xi}}}{t} + \int_{\partial V_i} f(\vec{\xi})\cdot\normal~dS_i
\end{align}
So that finally, the equation can be written as
\begin{align}
\tfrac{\dvec{\bar{\xi}}}{t} + \frac{1}{V_i} \int_{\partial V_i} f(\vec{\xi})\cdot\normal~dS_i
\end{align}
which can easily be interpreted. The cell average of the conserved properties changes according to the total flux through the cells surface.
Of course, the conservative value is defined as being constant within one cell, so there will be different values on faces or edges, depending on which side is one is looking at. There are different approaches on how to choose an appropriate value. And the choice made greatly effects the numerical properties. \textbf{Is this accurate? If so, provide more details.}

\subsection{Finite Volume method for fluid mechanics}\label{sec:fv_fluid_mechanics}
It has already been shown in Section REF, that the \ac{NSE} can be brought into the conservative form(Equation~REF). The flux has been shown to consist of a convective and a diffusive part(Equation~REF).
For this thesis, a \ac{MUSCL} type \ac{FV} framework for unstructured three-dimensional grids, as described in~\cite{Main2014} has been used.

The formulation is derived by re-writing equation~\ref{eq:nsg_conservative_form} in variational form by multiplying with a test function:
\begin{align}
\int_\Omega \pdfrac{\fstate}{t}\testfunc_i d\Omega +
\int_\Omega \nabla\cdot\fluxesconv(\fstate)\testfunc_i d\Omega +
 \int_{\Omega} \nabla\cdot\fluxesdiff(\fstate)\testfunc_i d\Omega = \vec{0}
\end{align}
where $\testfunc_i \in C^0(\Omega)$. For this formulation $\testfunc_i$ is chosen to be piecewise linear. Particularly, the test functions fulfill
\begin{align}
\testfunc_i(\vertex_j)=\delta_{ij}
\end{align}
Now, Gauss divergence theorem is applied to the last part, giving
\begin{align}
\int_\Omega \pdfrac{\fstate}{t}\testfunc_i ~d\Omega +
\int_\Omega \nabla\cdot\fluxesconv(\fstate)\testfunc_i ~d\Omega +
(\int_{\Gamma} \fluxesdiff(\fstate)\cdot\normal ~d\Gamma - \int_\Omega \fluxesdiff(\fstate)\cdot\nabla\testfunc_i ~d\Omega     ) =
\vec{0}
\end{align}
In contrast to a real \ac{FE} formulation, the contribution of the viscous flux at the far fields boundary is now neglected, as explained in \cite{Lakshminarayan2014}. How the boundary conditions at the far fields are taken care of will be explained at a proper place.
We finally get the mixed \ac{FV}-\ac{FE} form by mass lumping the first two terms. Since we are using a vertex-centered approach here, mass lumping is equivalent to using a constant test function of $\testfunc_i$ on the dual cell. We therefor get:
\begin{align}
\int_{\Omega_i} \pdfrac{\fstate}{t} ~d\Omega +
\int_{\Omega_i} \nabla\cdot\fluxesconv(\fstate) ~d\Omega -
\int_\Omega \fluxesdiff(\fstate)\cdot\nabla\testfunc_i ~d\Omega  =
\vec{0}
\end{align}
Please note that we have switched from an integral over the whole domain to an integral across the dual cells here.
Finally by averaging $\fstate$ over the cell in the first term, we can derive the \ac{FV} formulation as
\begin{align}
\pdfrac{\fstate_i}{t} +
\frac{1}{\norm{\Omega_i}} \int_{\Omega_i} \nabla\cdot\fluxesconv(\fstate) ~d\Omega_i -
\frac{1}{\norm{\Omega_i}} \int_\Omega \fluxesdiff(\fstate)\cdot\nabla\testfunc_i ~d\Omega  =
\vec{0}
\end{align}
Where now, $\fstate_i$ denotes the average of $\fstate$ in the dual cell $\Omega_i$, which is by construction the value of $\fstate$ at vertex $i$. The volume of cell $\Omega_i$ is denoted as $\norm{\Omega_i}$ here.
Finally, gauss divergence theorem is applied to the convective term, resulting in
\begin{align}\label{eq:nsg_basic_fv-form}
\pdfrac{\fstate_i}{t} +
\frac{1}{\norm{\Omega_i}} \int_{\partial\Omega_i} \fluxesconv(\fstate)\cdot dS -
\frac{1}{\norm{\Omega_i}} \int_\Omega \fluxesdiff(\fstate)\cdot\nabla\testfunc_i ~d\Omega  =
\vec{0}
\end{align}
 \\
 \\
As can be seen from picture \ref{fig:dualcell_unstructured}, the dual cells themselves can have very random shapes. This makes the integration over the boundary of the second term in Equation \eqref{eq:nsg_basic_fv-form} more cumbersome than in a primal approach. Also, the volume integral in the \ac{FE} like expression has to be splitted into regular shapes subdomains, e.g. tetrahedra, such that standard integration rules like gauss rule can be applied.




\begin{figure}[h]
\centering
\input{\mainpath/fig/pdf/FV_discretization_tetrahedra.pdf_tex}
\caption{\ac{FV} semi-discretization of an unstructured mesh. Vertex $i$ is the center of dual cell $C_i$. The boundary of the dual cell is denoted as $\pd C_{ij}$}
\label{fig:dualcell_unstructured}
\end{figure}


For a closer look into the convective fluxes integral, we decompose the boundary as $\pd \Omega_i = \sum_{i \in \vertexset(i)} \pd\Omega_{ij}$, where $\vertexset(i)$ denotes the set of vertices connected by an edge to vertex $i$.\\
In this thesis, the surface integral in equation REF is than approximated using a Riemann solver and a \ac{MUSCL} \cite{VanLeer1979} technique. This approximation can be written as
\begin{align}
\int_{\partial\Omega_i} \fluxesconv(\fstate)\cdot dS \approx
\sum_{j \in \vertexset(i)} \fluxesnum_{ij}(\fstate_{ij},\fstate{ji},\normal_{ij})
\end{align}
where $\fluxesnum_{ij}$ denotes the chosen numerical flux function along the edge $i-j$ and the two extrapolated fluid stated at the i and the j-side of the the intersection of the cell boundary $\partial \Omega_{ij}$ and edge $i-j$ are denoted by $\fstate_{ij}$ and $\fstate_{ji}$ respectively. The area-weighted normal of edge $i-j$ is denoted as $\normal_{ij}$.
 \\
 \\
As for the volume integral of the diffusive term in Equation~\eqref{eq:nsg_basic_fv-form}, it shall be noted that the shape function is still denoted in the primal cell. Since the gradient of the test function is constant, as is the diffusive flux itself, the integral becomes a summation of the primal sub-tetrahedral contributions.

\end{document}