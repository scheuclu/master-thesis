close all
clear
clc

femacdir = '../../FEMAC/'
addpath(femacdir)


%/home/lukas/Desktop/SA_Thesis/studies/2016-08-10_Partitioning/chaco/quads/feti1/tau1.dat


%% .
files.chaco.quads.feti1={...
    './chaco/quads/feti1/tau1.dat'
    './chaco/quads/feti1/tau10.dat'
    './chaco/quads/feti1/tau100.dat'
    './chaco/quads/feti1/tau1000.dat'}';
  
files.chaco.quads.feti2g={...
    './chaco/quads/feti2geneo/tau1.dat'
    './chaco/quads/feti2geneo/tau10.dat'
    './chaco/quads/feti2geneo/tau100.dat'
    './chaco/quads/feti2geneo/tau1000.dat'}';
  
files.chaco.quads.fetis={...
    './chaco/quads/fetis/tau1.dat'
    './chaco/quads/fetis/tau10.dat'
    './chaco/quads/fetis/tau100.dat'
    './chaco/quads/fetis/tau1000.dat'}';
  

  
files.regular.quads.feti1={...
    './regular/quads/feti1/tau1.dat'
    './regular/quads/feti1/tau10.dat'
    './regular/quads/feti1/tau100.dat'
    './regular/quads/feti1/tau1000.dat'}';
  
files.regular.quads.feti2g={...
    './regular/quads/feti2geneo/tau1.dat'
    './regular/quads/feti2geneo/tau10.dat'
    './regular/quads/feti2geneo/tau100.dat'
    './regular/quads/feti2geneo/tau1000.dat'}';
  
files.regular.quads.fetis={...
    './regular/quads/fetis/tau1.dat'
    './regular/quads/fetis/tau10.dat'
    './regular/quads/fetis/tau100.dat'
    './regular/quads/fetis/tau1000.dat'}';


%% Perform calculations

numiter.chaco.quads.feti1=[];
for iter=files.chaco.quads.feti1
  prob=femac(iter{:})
  numiter.chaco.quads.feti1=[numiter.chaco.quads.feti1,prob.main.solver_.numiter_];
  clear prob
end

numiter.chaco.quads.feti2g=[];
for iter=files.chaco.quads.feti2g
  prob=femac(iter{:})
  numiter.chaco.quads.feti2g=[numiter.chaco.quads.feti2g,prob.main.solver_.numiter_];
  clear prob
end


numiter.chaco.quads.fetis=[];
for iter=files.chaco.quads.fetis
  prob=femac(iter{:})
  numiter.chaco.quads.fetis=[numiter.chaco.quads.fetis,prob.main.solver_.numiter_];
  clear prob
end



numiter.regular.quads.feti1=[];
for iter=files.regular.quads.feti1
  prob=femac(iter{:})
  numiter.regular.quads.feti1=[numiter.regular.quads.feti1,prob.main.solver_.numiter_];
  clear prob
end

numiter.regular.quads.feti2g=[];
for iter=files.regular.quads.feti2g
  prob=femac(iter{:})
  numiter.regular.quads.feti2g=[numiter.regular.quads.feti2g,prob.main.solver_.numiter_];
  clear prob
end


numiter.regular.quads.fetis=[];
for iter=files.regular.quads.fetis
  prob=femac(iter{:})
  numiter.regular.quads.fetis=[numiter.regular.quads.fetis,prob.main.solver_.numiter_];
  clear prob
end



save('numiter','numiter');


%% Plot

tauvec=[1 10 100 1000];

figure()
semilogx(tauvec,numiter.chaco.quads.feti1,'-o',...
        tauvec,numiter.chaco.quads.feti2g,'-o',...
        tauvec,numiter.chaco.quads.fetis,'-o')
legend('FETI-1','FETI-2(Geneo)','FETI-S')
title('chaco partitioning')

figure()
loglog(tauvec,numiter.regular.quads.feti1,'-o',...
        tauvec,numiter.regular.quads.feti2g,'-o',...
        tauvec,numiter.regular.quads.fetis,'-o')
legend('FETI-1','FETI-2(Geneo)','FETI-S')
title('regular partitioning')




figure()
y=[...
    numiter.chaco.quads.feti1
    numiter.chaco.quads.feti2g
    numiter.chaco.quads.fetis     ]'
bar(y)
legend('FETI-1','FETI-2(Geneo)','FETI-S')
set(gca,'XTickLabel',{'1', '10', '100', '1000'}')


csvwrite('./data/chaco_quads_feti1.txt',[tauvec,numiter.chaco.quads.feti1]);
csvwrite('./data/chaco_quads_feti2.txt',[tauvec,numiter.chaco.quads.feti1]);
csvwrite('./data/chaco_quads_feti1.txt',[tauvec,numiter.chaco.quads.feti1]);



% csvwrite('./data/study_stiffnessratio_feti1.txt',[[1 2 3 4 6 10 20 50]',[yf1.tau1 yf1.tau2 yf1.tau3 yf1.tau4 yf1.tau6 yf1.tau10 yf1.tau20 yf1.tau50 ]'])
% csvwrite('./data/study_stiffnessratio_feti2geneo.txt',[[1 2 3 4 6 10 20 50]',[yf2.tau1 yf2.tau2 yf2.tau3 yf2.tau4 yf2.tau6 yf2.tau10 yf2.tau20 yf2.tau50 ]'])
% csvwrite('./data/study_stiffnessratio_fetis.txt',[[1 2 3 4 6 10 20 50]',[yfs.tau1 yfs.tau2 yfs.tau3 yfs.tau4 yfs.tau6 yfs.tau10 yfs.tau20 yfs.tau50 ]'])
